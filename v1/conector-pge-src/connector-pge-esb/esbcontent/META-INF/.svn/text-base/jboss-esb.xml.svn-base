<?xml version="1.0"?>
<jbossesb parameterReloadSecs="5"
 xmlns="http://anonsvn.labs.jboss.com/labs/jbossesb/trunk/product/etc/schemas/xml/jbossesb-1.3.0.xsd"
 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://anonsvn.labs.jboss.com/labs/jbossesb/trunk/product/etc/schemas/xml/jbossesb-1.3.0.xsd http://anonsvn.jboss.org/repos/labs/labs/jbossesb/trunk/product/etc/schemas/xml/jbossesb-1.3.0.xsd">
 <providers>
  <jbr-provider host="${jboss.bind.address}" name="JBR-Http" protocol="http">
   <jbr-bus busid="Http-Test" port="9800"/>
   <jbr-bus busid="Http-Production" port="9700"/>
  </jbr-provider>
 </providers>
 <services>
  <service category="AgesicPlataforma"
   description="Conector para invocaciones de test" invmScope="GLOBAL" name="TestEndpoint">
   <property name="maxThreads" value="20"/>
   <listeners>
    <jbr-listener busidref="Http-Test" is-gateway="true" maxThreads="20" name="Http-Gateway">
     <property name="serviceInvokerTimeout" value="120000"/>
    </jbr-listener>
   </listeners>
   <actions mep="RequestResponse">
    <action class="biz.ideasoft.soa.esb.actions.LogMessageAction" name="print-before-ejb">
     <property name="level" value="info"/>
     <property name="printfull" value="false"/>
     <property name="message" value="Message before invoking ejb"/>
    </action>
    <action class="uy.gub.agesic.esb.action.SetCurrentTimeAction" name="setCurrentInitialTime">
     <property name="bodyName" value="currentInitialTime"/>
     <property name="millisBodyName" value="currentInitialMillisTime"/>
    </action>
    <action
     class="uy.gub.agesic.esb.action.PropertiesLoadAction" name="load-file-properties">
     <property name="propertiesFile" value="/connector-pge/connector-pge.properties"/>
    </action>
    <action
     class="org.jboss.soa.esb.actions.scripting.GroovyActionProcessor" name="discover-context">
     <property name="script" value="/scripts/pathContextTest.groovy"/>
    </action>
    <action class="biz.ideasoft.soa.esb.actions.EJBProcessor" name="InvokeConnectorInfo">
     <property name="ejb3" value="true"/>
     <property name="jndi-name" value="connector-pge-ear/ConnectorManagerSession/remote"/>
     <property name="initial-context-factory" value="org.jnp.interfaces.NamingContextFactory"/>
     <property name="provider-url" value="${jboss.bind.address}:1099"/>
     <property name="method" value="getConnectorByPath"/>
     <property name="esb-out-var" value="fullConnector"/>
     <property name="ejb-params">
      <arg0 type="java.lang.String">Path</arg0>
      <arg1 type="java.lang.Boolean">connectorType</arg1>
     </property>
    </action>
    <action class="uy.gub.agesic.esb.action.QueryPathBasedRouter" name="route">
     <property name="wsdlServiceName" value="WSDLResolver"/>
     <property name="wsdlCategoryName" value="AgesicPlataforma"/>
     <property name="wsInvokerServiceName" value="PGEWSInvoker"/>
     <property name="wsInvokerCategoryName" value="AgesicPlataforma"/>
     <property name="timeout" value="120000"/>
    </action>
    <action class="uy.gub.agesic.esb.action.SetElapsedTimeAction" name="setElapsedTime">
     <property name="bodyName" value="currentInitialElapsedTime"/>
     <property name="millisBodyName" value="currentInitialMillisTime"/>
    </action>
    <action class="uy.gub.agesic.esb.action.ShowProcessTimeAction" name="showTimeInfo"/>
    <action class="biz.ideasoft.soa.esb.actions.LogMessageAction" name="print-msg-response">
     <property name="level" value="info"/>
     <property name="printfull" value="false"/>
     <property name="message" value="Message to response"/>
    </action>
   </actions>
  </service>
  <service category="AgesicPlataforma"
   description="Conector para invocaciones de produccion"
   invmScope="GLOBAL" name="ProductionEndpoint">
   <property name="maxThreads" value="20"/>
   <listeners>
    <jbr-listener busidref="Http-Production" is-gateway="true"
     maxThreads="20" name="Http-Gateway">
     <property name="serviceInvokerTimeout" value="120000"/>
    </jbr-listener>
   </listeners>
   <actions mep="RequestResponse">
    <action class="biz.ideasoft.soa.esb.actions.LogMessageAction" name="print-before-ejb">
     <property name="level" value="info"/>
     <property name="printfull" value="false"/>
     <property name="message" value="Message before invoking ejb"/>
    </action>
    <action class="uy.gub.agesic.esb.action.SetCurrentTimeAction" name="setCurrentInitialTime">
     <property name="bodyName" value="currentInitialTime"/>
     <property name="millisBodyName" value="currentInitialMillisTime"/>
    </action>
    <action
     class="uy.gub.agesic.esb.action.PropertiesLoadAction" name="load-file-properties">
     <property name="propertiesFile" value="/connector-pge/connector-pge.properties"/>
    </action>
    <action
     class="org.jboss.soa.esb.actions.scripting.GroovyActionProcessor" name="discover-context">
     <property name="script" value="/scripts/pathContextProd.groovy"/>
    </action>
    <action class="biz.ideasoft.soa.esb.actions.EJBProcessor" name="InvokeConnectorInfo">
     <property name="ejb3" value="true"/>
     <property name="jndi-name" value="connector-pge-ear/ConnectorManagerSession/remote"/>
     <property name="initial-context-factory" value="org.jnp.interfaces.NamingContextFactory"/>
     <property name="provider-url" value="${jboss.bind.address}:1099"/>
     <property name="method" value="getConnectorByPath"/>
     <property name="esb-out-var" value="fullConnector"/>
     <property name="ejb-params">
      <arg0 type="java.lang.String">Path</arg0>
      <arg1 type="java.lang.Boolean">connectorType</arg1>
     </property>
    </action>
    <action class="uy.gub.agesic.esb.action.QueryPathBasedRouter" name="route">
     <property name="wsdlServiceName" value="WSDLResolver"/>
     <property name="wsdlCategoryName" value="AgesicPlataforma"/>
     <property name="wsInvokerServiceName" value="PGEWSInvoker"/>
     <property name="wsInvokerCategoryName" value="AgesicPlataforma"/>
     <property name="timeout" value="120000"/>
    </action>
    <action class="uy.gub.agesic.esb.action.SetElapsedTimeAction" name="setElapsedTime">
     <property name="bodyName" value="currentInitialElapsedTime"/>
     <property name="millisBodyName" value="currentInitialMillisTime"/>
    </action>
    <action class="uy.gub.agesic.esb.action.ShowProcessTimeAction" name="showTimeInfo"/>
    <action class="biz.ideasoft.soa.esb.actions.LogMessageAction" name="print-msg-response">
     <property name="level" value="info"/>
     <property name="printfull" value="false"/>
     <property name="message" value="Message to response"/>
    </action>
   </actions>
  </service>
  <service category="AgesicPlataforma"
   description="Servicio que devuelve el WSDL" invmScope="GLOBAL" name="WSDLResolver">
   <actions mep="RequestResponse">
    <action class="biz.ideasoft.soa.esb.actions.LogMessageAction" name="print-input-msg">
     <property name="level" value="info"/>
     <property name="printfull" value="false"/>
     <property name="message" value="Input Message"/>
    </action>
    <action
     class="org.jboss.soa.esb.actions.scripting.GroovyActionProcessor" name="wsdl-reply">
     <property name="script" value="/scripts/wsdlReply.groovy"/>
    </action>
    <action
     class="uy.gub.agesic.esb.action.CheckWSDLAction" name="check-wsdl">
    </action>
    <action class="biz.ideasoft.soa.esb.actions.XSLTAction" name="modify-soap-location">
     <property name="xslt" value="/xsl/changeSOAPLocation.xsl"/>
     <property name="parameter">
      <parameter name="location" value="properties.location"/>
     </property>
    </action>
    <action class="biz.ideasoft.soa.esb.actions.LogMessageAction" name="print-wsdl-to-response">
     <property name="level" value="info"/>
     <property name="printfull" value="false"/>
     <property name="message" value="WSDL Message"/>
    </action>
   </actions>
  </service>
  <service category="AgesicPlataforma"
   description="Servicio esb para la invocacion a los servicio de la pge"
   invmScope="GLOBAL" name="PGEWSInvoker">
   <actions mep="RequestResponse">
    <action class="biz.ideasoft.soa.esb.actions.LogMessageAction" name="print-input-msg">
     <property name="level" value="info"/>
     <property name="printfull" value="false"/>
     <property name="message" value="Input Message"/>
    </action>
    <action
     class="org.jboss.soa.esb.actions.scripting.GroovyActionProcessor" name="physicalURL">
     <property name="script" value="/scripts/connectorToProperties.groovy"/>
    </action>
    <action
     class="uy.gub.agesic.esb.action.CheckConnectorAction" name="check-wsdl">
    </action>
    <action class="biz.ideasoft.soa.esb.actions.SaveMTOMBodyAction" name="save-mtom"/>
    <action class="biz.ideasoft.soa.esb.actions.ContentBasedTransformer" name="header-insert-action">
     <property name="namespaces">
      <namespace prefix="wsa" url="http://www.w3.org/2005/08/addressing"/>
      <namespace prefix="wsse" url="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"/>
     </property>
     <property name="xpaths">
      <xpath
       expr="local-name(/soapenv:Envelope/child::*[1]) != 'Header'" transformation="no-exist-header"/>
      <xpath
       expr="count(/soapenv:Envelope/child::*[1][local-name() = 'Header']/wsa:Action) = 0" transformation="no-exist-action"/>
     </property>
     <property name="transformations">
      <xslt name="no-exist-header" path="/xsl/addHeader.xsl">
       <parameter name="action" value="properties.wsaAction"/>
       <parameter name="to" value="properties.wsaTo"/>
      </xslt>
      <xslt name="no-exist-action" path="/xsl/addAction.xsl">
       <parameter name="action" value="properties.wsaAction"/>
      </xslt>
     </property>
    </action>
    <action class="biz.ideasoft.soa.esb.actions.ContentBasedTransformer" name="header-insert-to">
     <property name="namespaces">
      <namespace prefix="wsa" url="http://www.w3.org/2005/08/addressing"/>
      <namespace prefix="wsse" url="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"/>
     </property>
     <property name="xpaths">
      <xpath
       expr="count(/soapenv:Envelope/child::*[1][local-name() = 'Header']/wsa:To) = 0" transformation="no-exist-to"/>
     </property>
     <property name="transformations">
      <xslt name="no-exist-to" path="/xsl/addTo.xsl">
       <parameter name="to" value="properties.wsaTo"/>
      </xslt>
     </property>
    </action>
    <action class="uy.gub.agesic.esb.action.SetCurrentTimeAction" name="setCurrentStsTime">
     <property name="bodyName" value="currentStsTime"/>
     <property name="millisBodyName" value="currentStsMillisTime"/>
    </action>
    <action
     class="uy.gub.agesic.soa.wsa.esb.actions.sts.v2.RequestSignedTokenAction" name="token">
     <property name="aliasProperty" value="alias"/>
     <property name="keyStoreOrgFilePathProperty" value="keyStoreOrgFilePath"/>
     <property name="keyStoreFilePathProperty" value="keyStoreFilePath"/>
     <property name="keyStoreOrgPwdProperty" value="keyStoreOrgPwd"/>
     <property name="keyStorePwdProperty" value="keyStorePwd"/>
     <property name="trustStoreFilePathProperty" value="trustStoreFilePath"/>
     <property name="trustStorePwdProperty" value="trustStorePwd"/>
     <property name="issuerProperty" value="issuer"/>
     <property name="policyNameProperty" value="policyName"/>
     <property name="roleProperty" value="role"/>
     <property name="userNameProperty" value="userName"/>
     <property name="service-property" value="wsaTo"/>
     <property name="stsURL" value="stsURL"/>
    </action>
    <action class="uy.gub.agesic.esb.action.SetElapsedTimeAction" name="setElapsedStsTime">
     <property name="bodyName" value="currentStsElapsedTime"/>
     <property name="millisBodyName" value="currentStsMillisTime"/>
    </action>
    <action class="biz.ideasoft.soa.esb.actions.LogMessageAction" name="print-after-sts">
     <property name="level" value="info"/>
     <property name="printfull" value="false"/>
     <property name="message" value="Message after request signed token"/>
    </action>
    <action class="biz.ideasoft.soa.esb.actions.RestoreMTOMBodyAction" name="restore-mtom"/>
    <action class="uy.gub.agesic.esb.action.SetCurrentTimeAction" name="setCurrentWSTime">
     <property name="bodyName" value="currentWSTime"/>
     <property name="millisBodyName" value="currentWSMillisTime"/>
    </action>
    <action
     class="uy.gub.agesic.soa.wsa.esb.actions.sts.v2.WSInvokeAction" name="wsInvoker-action">
     <property name="urlPropertyLocation" value="routePhysicalURL"/>
     <property name="SOAPActionPropertyLocation" value="wsaAction"/>
     <property name="keyStoreFilePathProperty" value="keyStoreFilePath"/>
     <property name="keyStorePwdProperty" value="keyStorePwd"/>
     <property name="trustStoreFilePathProperty" value="trustStoreFilePath"/>
     <property name="trustStorePwdProperty" value="trustStorePwd"/>
     <property name="maxConnectionsPerHost" value="10"/>
    </action>
    <action class="uy.gub.agesic.esb.action.SetElapsedTimeAction" name="setCurrentWSElapsedTime">
     <property name="bodyName" value="currentWSElapsedTime"/>
     <property name="millisBodyName" value="currentWSMillisTime"/>
    </action>
    <!-- <action class="biz.ideasoft.soa.esb.actions.SaveMTOMBodyAction" name="save-mtom" /> -->
   </actions>
  </service>
 </services>
</jbossesb>
