<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
     xmlns:h="http://java.sun.com/jsf/html"
     xmlns:f="http://java.sun.com/jsf/core"
     xmlns:ui="http://java.sun.com/jsf/facelets"
     xmlns:a="http://richfaces.org/a4j"
     xmlns:rich="http://richfaces.org/rich"
     xmlns:t="http://myfaces.apache.org/tomahawk"
     template="/templates/template.xhtml">		
     	
	<ui:define name="pageTitle">Init</ui:define>
	<ui:define name="pageHeader">Init</ui:define>

	<ui:define name="body">
		<h:form id="form1" enctype="multipart/form-data">
			<rich:toolTip value="#{msg.pathTooltip}" for="labelTooltipPath"/>
			<rich:toolTip value="#{msg.urlTooltip}" for="labelTooltipUrl"/>
			
			<h:panelGroup>
				<h:outputText value="#{msg.type}: " />
				<h:selectOneListbox id="type" value="#{globalConf.type}" size="1" valueChangeListener="#{globalConf.refreshConfigData}">
					<a:support event="onchange" reRender="formPanel" ajaxSingle="true"/>
					<f:selectItem id="item1" itemLabel="#{globalConf.typeTestingLabel}" itemValue="#{globalConf.typeTesting}" />
					<f:selectItem id="item2" itemLabel="#{globalConf.typeProductionLabel}" itemValue="#{globalConf.typeProduction}" />
				</h:selectOneListbox>
			</h:panelGroup>
			
			<br/><br/>
			
			<h:panelGrid columns="4" id="formPanel">
				<h:outputLabel value="#{msg.aliasKeystore}*"/>
				<h:inputText id="alias" value="#{globalConf.globalConf.aliasKeystore}" size="60" required="true">
					<f:validateLength maximum="100"/>
				</h:inputText>
				<h:message for="alias" errorClass="fieldError"/>
				<rich:spacer/>
				
				<h:outputLabel value="#{msg.passKeystoreOrg}*"/>
				<h:inputSecret id="password_keystoreOrg" value="#{globalConf.keystoreOrganismoPass}" size="60" redisplay="true" required="true" autocomplete="off">
					<f:validateLength maximum="100"/>
				</h:inputSecret>
				<h:message for="password_keystoreOrg" errorClass="fieldError"/>
				<rich:spacer/>
				
				<h:outputLabel value="#{msg.passKeystore}*"/>
				<h:inputSecret id="password_keystore" value="#{globalConf.keystoreSSLPass}" size="60" redisplay="true" required="true" autocomplete="off">
					<f:validateLength maximum="100"/>
				</h:inputSecret>
				<h:message for="password_keystore" errorClass="fieldError"/>
				<rich:spacer/>

				<h:outputLabel value="#{msg.passKeystoreSsl}*"/>
				<h:inputSecret id="password_keystore_ssl" value="#{globalConf.trustorePass}" size="60" redisplay="true" required="true" autocomplete="off">
					<f:validateLength maximum="100"/>
				</h:inputSecret>
				<h:message for="password_keystore_ssl" errorClass="fieldError"/>
				<rich:spacer/>				
				
				
				<h:outputLabel value="#{msg.keystoreOrg}*"/>
				<h:panelGroup id="keystoreOrganismo">
					<t:inputFileUpload id="keystoreOrgFile" storage="file" required="#{globalConf.keystoreOrgRequired}" 
						value="#{globalConf.keystoreOrgUploadFile}" size="40" style="margin-right:5px;" rendered="#{empty globalConf.keystoreOrgUploadFile}"/>
					<h:outputLabel value="Archivo subido : #{globalConf.nameKeystoreOrgUploadFile} " rendered="#{not empty globalConf.keystoreOrgUploadFile}"/>
					<h:commandButton action="#{globalConf.cleanKeystoreOrg}" value="Borra el archivo subido" image="../img/broom.png" label="Borra el archivo subido" title="#{msg.clean}" rendered="#{not empty globalConf.keystoreOrgUploadFile}" >
					</h:commandButton>
					<h:outputLink value="#{facesContext.externalContext.requestContextPath}/fileDownload?type=#{globalConf.globalConf.type}&amp;typeFile=globalFile&amp;fileName=#{globalConf.pathKeystoreOrg}" 
							rendered="#{globalConf.globalConf.existKeystoreOrg}" style="margin-right:5px;"><img src="../img/download.png" alt="#{msg.download}" title="#{msg.download}" /></h:outputLink>
					<h:commandButton action="#{globalConf.validateKeystoreOrg}" value="Verifica el keystore" image="../img/ok.png" label="Cargar" title="#{msg.validate}" rendered="#{globalConf.globalConf.existKeystoreOrg}" >
					</h:commandButton>
					<a:commandLink action="#{certViewer.showCertificates}" oncomplete="Richfaces.showModalPanel('keystoreViewer');" reRender="keystoreViewer" rendered="#{globalConf.globalConf.existKeystoreOrg}" title="#{msg.detail}"> 
					    	<img src="../img/find.png" title="#{messages['general.edit']}" />
					    	<f:setPropertyActionListener value="ORGANISMO" target="#{certViewer.storeType}" />
					    	<f:setPropertyActionListener value="#{globalConf.filePathBean}" target="#{certViewer.filesPathBean}" />
					    	<f:setPropertyActionListener value="#{globalConf.globalConf.aliasKeystore}" target="#{certViewer.alias}" />
					    	<f:setPropertyActionListener value="#{globalConf.keystoreOrganismoPass}" target="#{certViewer.keyStorePwd}" />
					    	<f:setPropertyActionListener value="#{globalConf.globalConf.passwordKeystoreOrg}" target="#{certViewer.storedPasswordOrg}" />
					</a:commandLink>
				</h:panelGroup>
				<h:message for="keystoreOrgFile" errorClass="fieldError"/>
				<rich:spacer/>
				
				<h:outputLabel value="#{msg.keystore}*"/>
				<h:panelGroup>
					<t:inputFileUpload id="keystoreFile" storage="file" required="#{globalConf.keystoreRequired}" 
						value="#{globalConf.keystoreUploadFile}" size="40" style="margin-right:5px;" rendered="#{empty globalConf.keystoreUploadFile}"/>
					<h:outputLabel value="Archivo subido : #{globalConf.nameKeystoreUploadFile} " rendered="#{not empty globalConf.keystoreUploadFile}"/>
					<h:commandButton action="#{globalConf.cleanKeystore}" value="Borra el archivo subido" image="../img/broom.png" label="Borra el archivo subido" title="#{msg.clean}" rendered="#{not empty globalConf.keystoreUploadFile}" >
					</h:commandButton>
					<h:outputLink value="#{facesContext.externalContext.requestContextPath}/fileDownload?type=#{globalConf.globalConf.type}&amp;typeFile=globalFile&amp;fileName=#{globalConf.pathKeystore}" 
							rendered="#{globalConf.globalConf.existKeystore}" style="margin-right:5px;"><img src="../img/download.png" alt="#{msg.download}" title="#{msg.download}"/></h:outputLink>
					<h:commandButton action="#{globalConf.validateKeystoreSSL}" value="Verifica el keystore" image="../img/ok.png" label="Cargar" title="#{msg.validate}" rendered="#{globalConf.globalConf.existKeystore}" >
					</h:commandButton>
					<a:commandLink action="#{certViewer.showCertificates}" oncomplete="Richfaces.showModalPanel('keystoreViewer');" reRender="keystoreViewer" rendered="#{globalConf.globalConf.existKeystore}" title="#{msg.detail}" > 
					    	<img src="../img/find.png" title="#{messages['general.edit']}" />
					    	<f:setPropertyActionListener value="KEYSTORE_SSL" target="#{certViewer.storeType}" />
					    	<f:setPropertyActionListener value="#{globalConf.filePathBean}" target="#{certViewer.filesPathBean}" />
					    	<f:setPropertyActionListener value="#{globalConf.globalConf.aliasKeystore}" target="#{certViewer.alias}" />
					    	<f:setPropertyActionListener value="#{globalConf.keystoreSSLPass}" target="#{certViewer.keyStoreSSLPwd}" />
					    	<f:setPropertyActionListener value="#{globalConf.globalConf.passwordKeystore}" target="#{certViewer.storedPasswordSsl}" /> 
					</a:commandLink>
				</h:panelGroup>
				<h:message for="keystoreFile" errorClass="fieldError"/>
				<rich:spacer/>				
				
				<h:outputLabel value="#{msg.keystoreSsl}*"/>
				<h:panelGroup>
					<t:inputFileUpload id="keystoreSslFile" storage="file" required="#{globalConf.keystoreSslRequired}" 
						value="#{globalConf.keystoreSslUploadFile}" size="40" style="margin-right:5px;" rendered="#{empty globalConf.keystoreSslUploadFile}"/>
					<h:outputLabel value="Archivo subido : #{globalConf.nameKeystoreSslUploadFile} " rendered="#{not empty globalConf.keystoreSslUploadFile}"/>
					<h:commandButton action="#{globalConf.cleanKeystoreSslOrg}" value="Borra el archivo subido" image="../img/broom.png" label="Borra el archivo subido" title="#{msg.clean}" rendered="#{not empty globalConf.keystoreSslUploadFile}" >
					</h:commandButton>
					<h:outputLink value="#{facesContext.externalContext.requestContextPath}/fileDownload?type=#{globalConf.globalConf.type}&amp;typeFile=globalFile&amp;fileName=#{globalConf.pathKeystoreSsl}" 
							rendered="#{globalConf.globalConf.existKeystoreSsl}" style="margin-right:5px;"><img src="../img/download.png" alt="#{msg.download}" title="#{msg.download}"/></h:outputLink>
					<a:commandLink action="#{certViewer.showCertificates}" oncomplete="Richfaces.showModalPanel('keystoreViewer');" reRender="keystoreViewer" rendered="#{globalConf.globalConf.existKeystoreSsl}" title="#{msg.detail}"> 
					    	<img src="../img/find.png" title="#{messages['general.edit']}" />
					    	<f:setPropertyActionListener value="TRUSTORE" target="#{certViewer.storeType}" />
					    	<f:setPropertyActionListener value="#{globalConf.filePathBean}" target="#{certViewer.filesPathBean}" />
					    	<f:setPropertyActionListener value="#{globalConf.globalConf.aliasKeystore}" target="#{certViewer.alias}" />
					    	<f:setPropertyActionListener value="#{globalConf.trustorePass}" target="#{certViewer.truststorePwd}" />
					    	<f:setPropertyActionListener value="#{globalConf.globalConf.passwordKeystoreSsl}" target="#{certViewer.storedPasswordTruststore}" />  
					</a:commandLink>
				</h:panelGroup>
				<h:message for="keystoreSslFile" errorClass="fieldError"/>
				<rich:spacer/>				
				
				<rich:spacer/>
				<br/>
				<rich:spacer/>
				<rich:spacer/>				
				
				
			</h:panelGrid>
			
			<br />
			<br />
               <div align="center">
				<h:commandButton action="home" value="#{msg.cancel}" immediate="true" onclick="if (!confirm('Los campos modificados (si los hay) no ser&#225;n guardados. Confirma?')) return false;"/>
				&#160;&#160;&#160;
				<h:commandButton action="#{globalConf.save}" value="#{msg.save}"/>
				&#160;&#160;&#160;
				
			</div>			
			
		</h:form>		

	<rich:modalPanel width="600" height="160" id="keystoreViewer">
			<f:facet name="header">
				<h:panelGroup>
					<h:outputText value="#{certViewer.storeTitle}"></h:outputText>
				</h:panelGroup>
			</f:facet>
			<f:facet name="controls">
				<h:panelGroup>
					<h:graphicImage value="../img/cross.png" styleClass="hidelink"
						id="hideKeystoreViewer" />
					<rich:componentControl for="keystoreViewer"
						attachTo="hideKeystoreViewer" operation="hide" event="onclick" />
				</h:panelGroup>
			</f:facet>
			<h:panelGroup rendered="#{not certViewer.storeValidated}">
				<h:outputText value="#{certViewer.errorMsg}" styleClass="errormsg" />
			</h:panelGroup>

			<a:repeat value="#{certViewer.keystoreInfoList}" var="keystore"
				id="repeat">
				<rich:panel style="float:left; width:700px; padding:5px;">
					<h:panelGrid columns="2" rendered="#{certViewer.storeValidated}">
						<h:panelGroup>
							<h:outputLabel value="Alias" />
						</h:panelGroup>
						<h:panelGroup>
							<h:outputLabel value="#{keystore.alias}" />
						</h:panelGroup>
						<h:panelGroup>
							<h:outputLabel value="Tipo" />
						</h:panelGroup>
						<h:panelGroup>
							<h:outputLabel value="#{keystore.type}" />
						</h:panelGroup>
						<h:panelGroup>
							<h:outputLabel value="Proveedor" />
						</h:panelGroup>
						<h:panelGroup>
							<h:outputLabel value="#{keystore.provider}" />
						</h:panelGroup>
						<h:panelGroup>
							<h:outputLabel value="Fecha Creacion" />
						</h:panelGroup>
						<h:panelGroup>
							<h:outputLabel value="#{keystore.creationDate}" />
						</h:panelGroup>
						<h:panelGroup>
							<h:outputLabel value="Fecha de Vecimiento" />
						</h:panelGroup>
						<h:panelGroup>
							<h:outputLabel value="#{keystore.expirationDate}" />
						</h:panelGroup>
					</h:panelGrid>
				</rich:panel>
			</a:repeat>
		</rich:modalPanel>

	</ui:define>
</ui:composition>