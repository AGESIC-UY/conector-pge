<?xml version="1.0"?>
<jbossesb parameterReloadSecs="5"
	xmlns="http://anonsvn.labs.jboss.com/labs/jbossesb/trunk/product/etc/schemas/xml/jbossesb-1.3.0.xsd"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://anonsvn.labs.jboss.com/labs/jbossesb/trunk/product/etc/schemas/xml/jbossesb-1.3.0.xsd http://anonsvn.jboss.org/repos/labs/labs/jbossesb/trunk/product/etc/schemas/xml/jbossesb-1.3.0.xsd">
	<providers>
		<jbr-provider host="${jboss.bind.address}" name="JBR-Http"
			protocol="http">
			<jbr-bus busid="Http-Test" port="9800" />
			<jbr-bus busid="Http-Production" port="9700" />
		</jbr-provider>
		
		<jms-provider name="JBossMQ" connection-factory="ConnectionFactory">
			<jms-bus busid="loggerEsbChannel">
				<jms-message-filter dest-type="QUEUE" dest-name="queue/connector_logger_esb" />
			</jms-bus>
		</jms-provider>
	</providers>
	
	<services>
		<service category="AgesicPlataforma" description="Conector para invocaciones de test"
			invmScope="GLOBAL" name="TestEndpoint">
			<property name="maxThreads" value="20" />
			<listeners>
				<jbr-listener busidref="Http-Test" is-gateway="true"
					maxThreads="20" name="Http-Gateway">
					<property name="serviceInvokerTimeout" value="60000" />
				</jbr-listener>
			</listeners>
			<actions mep="RequestResponse">
				<action class="uy.gub.agesic.esb.action.ErrorMessageAction"
					name="showBody-TestEndpoint">
					<property name="body1" value="currentInitialTime" />
					<property name="body2" value="currentInitialMillisTime" />
					<property name="body3" value="currentInitialElapsedTime" />
					<property name="body4" value="currentInitialMillisTime" />
					<property name="origin" value="CON"/>
					<property name="loggerJMS" value="false"/>
					<property name="serviceCategory" value="AgesicPlataforma"/>
					<property name="serviceName" value="ConnectorLogger"/>
					<property name="serviceCategoryJMS" value="AgesicPlataforma"/>
					<property name="serviceNameJMS" value="ConnectorLoggerJMS"/>
					<property name="intermediate" value="http://servicios.pge.red.uy/conectorPGE"/>
				</action>
				<action class="biz.ideasoft.soa.esb.actions.LogMessageAction"
					name="print-before-ejb">
					<property name="level" value="info" />
					<property name="printfull" value="false" />
					<property name="message" value="Message before invoking ejb" />
				</action>
				<action class="uy.gub.agesic.esb.action.SetCurrentTimeAction"
					name="setCurrentInitialTime">
					<property name="bodyName" value="currentInitialTime" />
					<property name="millisBodyName" value="currentInitialMillisTime" />
				</action>
				<action class="uy.gub.agesic.esb.action.PropertiesLoadAction"
					name="load-file-properties">
					<property name="propertiesFile" value="/connector-pge/connector-pge.properties" />
				</action>
				<action class="uy.gub.agesic.esb.action.PathContextAction" name="discover-context">
					<property name="connectorType" value="false" />
				</action>
				<action class="biz.ideasoft.soa.esb.actions.EJBProcessor"
					name="InvokeConnectorInfo">
					<property name="ejb3" value="true" />
					<property name="jndi-name"
						value="connector-pge-ear/ConnectorManagerSession/remote" />
					<property name="initial-context-factory" value="org.jnp.interfaces.NamingContextFactory" />
					<property name="provider-url" value="${jboss.bind.address}:1099" />
					<property name="method" value="getConnectorByPath" />
					<property name="esb-out-var" value="fullConnector" />
					<property name="ejb-params">
						<arg0 type="java.lang.String">Path</arg0>
						<arg1 type="java.lang.Boolean">connectorType</arg1>
					</property>
				</action>
				<action class="uy.gub.agesic.esb.action.ConnectorLoggerAction" name="log-message">
					<property name="origin" value="CON"/>
					<property name="loggerJMS" value="false"/>
					<property name="serviceCategory" value="AgesicPlataforma"/>
					<property name="serviceName" value="ConnectorLogger"/>
					<property name="serviceCategoryJMS" value="AgesicPlataforma"/>
					<property name="serviceNameJMS" value="ConnectorLoggerJMS"/>
					<property name="traceLevel" value="info" />
				</action>
				<action class="uy.gub.agesic.esb.action.QueryPathBasedRouter"
					name="route">
					<property name="wsdlServiceName" value="WSDLResolver" />
					<property name="wsdlCategoryName" value="AgesicPlataforma" />
					<property name="wsInvokerServiceName" value="PGEWSInvoker" />
					<property name="wsInvokerCategoryName" value="AgesicPlataforma" />
					<property name="timeout" value="60000" />
				</action>
				
				<action class="uy.gub.agesic.esb.action.SetElapsedTimeAction"
					name="setElapsedTime">
					<property name="bodyName" value="currentInitialElapsedTime" />
					<property name="millisBodyName" value="currentInitialMillisTime" />
				</action>
				<action class="uy.gub.agesic.esb.action.ShowProcessTimeAction"
					name="showTimeInfo" />
				<action class="biz.ideasoft.soa.esb.actions.LogMessageAction"
					name="print-msg-response">
					<property name="level" value="info" />
					<property name="printfull" value="false" />
					<property name="message" value="Message to response" />
				</action>
			</actions>
		</service>
		<service category="AgesicPlataforma" description="Conector para invocaciones de produccion"
			invmScope="GLOBAL" name="ProductionEndpoint">
			<property name="maxThreads" value="20" />
			<listeners>
				<jbr-listener busidref="Http-Production" is-gateway="true"
					maxThreads="20" name="Http-Gateway">
					<property name="serviceInvokerTimeout" value="60000" />
				</jbr-listener>
			</listeners>
			<actions mep="RequestResponse">
				<action class="uy.gub.agesic.esb.action.ErrorMessageAction"
					name="showBody-ProductionEndpoint">
					<property name="body1" value="currentInitialTime" />
					<property name="body2" value="currentInitialMillisTime" />
					<property name="body3" value="currentInitialElapsedTime" />
					<property name="body4" value="currentInitialMillisTime" />
					<property name="origin" value="CON"/>
					<property name="loggerJMS" value="false"/>
					<property name="serviceCategory" value="AgesicPlataforma"/>
					<property name="serviceName" value="ConnectorLogger"/>
					<property name="serviceCategoryJMS" value="AgesicPlataforma"/>
					<property name="serviceNameJMS" value="ConnectorLoggerJMS"/>
					<property name="intermediate" value="http://servicios.pge.red.uy/conectorPGE"/>
				</action>
				<action class="biz.ideasoft.soa.esb.actions.LogMessageAction"
					name="print-before-ejb">
					<property name="level" value="info" />
					<property name="printfull" value="false" />
					<property name="message" value="Message before invoking ejb" />
				</action>
				<action class="uy.gub.agesic.esb.action.SetCurrentTimeAction"
					name="setCurrentInitialTime">
					<property name="bodyName" value="currentInitialTime" />
					<property name="millisBodyName" value="currentInitialMillisTime" />
				</action>
				<action class="uy.gub.agesic.esb.action.PropertiesLoadAction"
					name="load-file-properties">
					<property name="propertiesFile" value="/connector-pge/connector-pge.properties" />
				</action>
				<action class="uy.gub.agesic.esb.action.PathContextAction" name="discover-context">
					<property name="connectorType" value="true" />
				</action>
				<action class="biz.ideasoft.soa.esb.actions.EJBProcessor"
					name="InvokeConnectorInfo">
					<property name="ejb3" value="true" />
					<property name="jndi-name"
						value="connector-pge-ear/ConnectorManagerSession/remote" />
					<property name="initial-context-factory" value="org.jnp.interfaces.NamingContextFactory" />
					<property name="provider-url" value="${jboss.bind.address}:1099" />
					<property name="method" value="getConnectorByPath" />
					<property name="esb-out-var" value="fullConnector" />
					<property name="ejb-params">
						<arg0 type="java.lang.String">Path</arg0>
						<arg1 type="java.lang.Boolean">connectorType</arg1>
					</property>
				</action>
				<action class="uy.gub.agesic.esb.action.ConnectorLoggerAction" name="log-message">
					<property name="origin" value="CON"/>
					<property name="loggerJMS" value="false"/>
					<property name="serviceCategory" value="AgesicPlataforma"/>
					<property name="serviceName" value="ConnectorLogger"/>
					<property name="serviceCategoryJMS" value="AgesicPlataforma"/>
					<property name="serviceNameJMS" value="ConnectorLoggerJMS"/>
					<property name="traceLevel" value="info" />
				</action>
				<action class="uy.gub.agesic.esb.action.QueryPathBasedRouter"
					name="route">
					<property name="wsdlServiceName" value="WSDLResolver" />
					<property name="wsdlCategoryName" value="AgesicPlataforma" />
					<property name="wsInvokerServiceName" value="PGEWSInvoker" />
					<property name="wsInvokerCategoryName" value="AgesicPlataforma" />
					<property name="timeout" value="60000" />
				</action>
				<action class="uy.gub.agesic.esb.action.SetElapsedTimeAction"
					name="setElapsedTime">
					<property name="bodyName" value="currentInitialElapsedTime" />
					<property name="millisBodyName" value="currentInitialMillisTime" />
				</action>
				<action class="uy.gub.agesic.esb.action.ShowProcessTimeAction"
					name="showTimeInfo" />
				<action class="biz.ideasoft.soa.esb.actions.LogMessageAction"
					name="print-msg-response">
					<property name="level" value="info" />
					<property name="printfull" value="false" />
					<property name="message" value="Message to response" />
				</action>
			</actions>
		</service>
		<service category="AgesicPlataforma" description="Servicio que devuelve el WSDL"
			invmScope="GLOBAL" name="WSDLResolver">
			<property name="maxThreads" value="20" />
			<property name="inVMPassByValue" value="true" />
			<actions mep="RequestResponse">
				<action class="biz.ideasoft.soa.esb.actions.LogMessageAction"
					name="print-input-msg">
					<property name="level" value="info" />
					<property name="printfull" value="false" />
					<property name="message" value="Input Message" />
				</action>
<!-- 				<action class="org.jboss.soa.esb.actions.scripting.GroovyActionProcessor" -->
<!-- 					name="wsdl-reply"> -->
<!-- 					<property name="script" value="/scripts/wsdlReply.groovy" /> -->
<!-- 				</action> -->
				<action class="uy.gub.agesic.esb.action.ResourceReplyAction" name="resource-reply"/>
				<action class="uy.gub.agesic.esb.action.CheckResourceAction"
					name="check-resource">
				</action>
				<action class="biz.ideasoft.soa.esb.actions.XSLTAction" name="modify-soap-location">
					<property name="xslt" value="/xsl/changeResourceLocation.xsl" />
					<property name="parameter">
						<parameter name="location" value="properties.location" />
					</property>
				</action>
				<action class="biz.ideasoft.soa.esb.actions.LogMessageAction"
					name="print-wsdl-to-response">
					<property name="level" value="info" />
					<property name="printfull" value="false" />
					<property name="message" value="WSDL Message" />
				</action>
			</actions>
		</service>
		<service category="AgesicPlataforma"
			description="Servicio esb para la invocacion a los servicio de la pge"
			invmScope="GLOBAL" name="PGEWSInvoker">
			<property name="maxThreads" value="20" />
			<property name="inVMPassByValue" value="true" />
			<actions mep="RequestResponse">
				<action class="uy.gub.agesic.esb.action.ErrorMessageAction"
					name="showBody-PGEWSInvoker">
					<property name="body1" value="currentPGEWSInvokerTime" />
					<property name="body2" value="currentPGEWSInvokerMillisTime" />
					<property name="body3" value="currentStsTime" />
					<property name="body4" value="currentStsMillisTime" />
					<property name="body5" value="currentWSElapsedTime" />
					<property name="body6" value="currentWSMillisTime" />
					<property name="origin" value="CON"/>
					<property name="loggerJMS" value="false"/>
					<property name="serviceCategory" value="AgesicPlataforma"/>
					<property name="serviceName" value="ConnectorLogger"/>
					<property name="serviceCategoryJMS" value="AgesicPlataforma"/>
					<property name="serviceNameJMS" value="ConnectorLoggerJMS"/>
					<property name="intermediate" value="http://servicios.pge.red.uy/conectorPGE"/>
				</action>
				<action class="uy.gub.agesic.esb.action.SetCurrentTimeAction"
					name="setCurrentPGEWSInvokerTime">
					<property name="bodyName" value="currentPGEWSInvokerTime" />
					<property name="millisBodyName" value="currentPGEWSInvokerMillisTime" />
				</action>
				<action class="biz.ideasoft.soa.esb.actions.LogMessageAction"
					name="print-input-msg">
					<property name="level" value="info" />
					<property name="printfull" value="false" />
					<property name="message" value="Input Message" />
				</action>
				<action class="biz.ideasoft.soa.esb.actions.SaveMTOMBodyAction"
					name="save-mtom" />
				<action class="uy.gub.agesic.esb.action.ConnectorToPropertiesAction"
					name="physicalURL">
				</action>
				<action class="uy.gub.agesic.esb.action.CheckConnectorAction"
					name="check-wsdl">
				</action>
				<action class="biz.ideasoft.soa.esb.actions.ContentBasedTransformer"
					name="header-insert-action">
					<property name="namespaces">
						<namespace prefix="wsa" url="http://www.w3.org/2005/08/addressing" />
						<namespace prefix="wsse"
							url="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd" />
					</property>
					<property name="xpaths">
						<xpath expr="local-name(/soapenv:Envelope/child::*[1]) != 'Header'"
							transformation="no-exist-header" />
						<xpath
							expr="count(/soapenv:Envelope/child::*[1][local-name() = 'Header']/wsa:Action) = 0"
							transformation="no-exist-action" />
					</property>
					<property name="transformations">
						<xslt name="no-exist-header" path="/xsl/addHeader.xsl">
							<parameter name="action" value="properties.wsaAction" />
							<parameter name="to" value="properties.wsaTo" />
							<parameter name="messageID" value="header.call.messageID" />
						</xslt>
						<xslt name="no-exist-action" path="/xsl/addAction.xsl">
							<parameter name="action" value="properties.wsaAction" />
							<parameter name="messageID" value="header.call.messageID" />
						</xslt>
					</property>
				</action>
				<action class="biz.ideasoft.soa.esb.actions.ContentBasedTransformer"
					name="header-insert-to">
					<property name="namespaces">
						<namespace prefix="wsa" url="http://www.w3.org/2005/08/addressing" />
						<namespace prefix="wsse"
							url="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd" />
					</property>
					<property name="xpaths">
						<xpath
							expr="count(/soapenv:Envelope/child::*[1][local-name() = 'Header']/wsa:To) = 0"
							transformation="no-exist-to" />
					</property>
					<property name="transformations">
						<xslt name="no-exist-to" path="/xsl/addTo.xsl">
							<parameter name="to" value="properties.wsaTo" />
							<parameter name="messageID" value="header.call.messageID" />
						</xslt>
					</property>
				</action>
				<action class="uy.gub.agesic.esb.action.SetCurrentTimeAction"
					name="setCurrentStsTime">
					<property name="bodyName" value="currentStsTime" />
					<property name="millisBodyName" value="currentStsMillisTime" />
				</action>
				<action
					class="uy.gub.agesic.soa.wsa.esb.actions.sts.v2.RequestCachedSignedTokenAction"
					name="token">
					<property name="aliasProperty" value="alias" />
					<property name="keyStoreOrgFilePathProperty" value="keyStoreOrgFilePath" />
					<property name="keyStoreFilePathProperty" value="keyStoreFilePath" />
					<property name="keyStoreOrgPwdProperty" value="keyStoreOrgPwd" />
					<property name="keyStorePwdProperty" value="keyStorePwd" />
					<property name="trustStoreFilePathProperty" value="trustStoreFilePath" />
					<property name="trustStorePwdProperty" value="trustStorePwd" />
					<property name="issuerProperty" value="issuer" />
					<property name="policyNameProperty" value="policyName" />
					<property name="roleProperty" value="role" />
					<property name="userNameProperty" value="userName" />
					<property name="service-property" value="wsaTo" />
					<property name="stsURL" value="stsURL" />
					<property name="skipSTS" value="false"/>
					<property name="keyStoreOrgCheckValidity" value="true"/>
					<property name="timeoutMillis" value="2000" />
					<property name="actor" value="agesic" />
					<property name="userNameTokenNameProperty" value="userNameTokenName" />
					<property name="userNameTokenPasswordProperty" value="userNameTokenPassword" />
				</action>
				<action class="uy.gub.agesic.esb.action.SetElapsedTimeAction"
					name="setElapsedStsTime">
					<property name="bodyName" value="currentStsElapsedTime" />
					<property name="millisBodyName" value="currentStsMillisTime" />
				</action>
				<action class="biz.ideasoft.soa.esb.actions.LogMessageAction"
					name="print-after-sts">
					<property name="level" value="info" />
					<property name="printfull" value="false" />
					<property name="message" value="Message after request signed token" />
				</action>
				<action class="biz.ideasoft.soa.esb.actions.RestoreMTOMBodyAction"
					name="restore-mtom" />
				<action class="uy.gub.agesic.esb.action.SetCurrentTimeAction"
					name="setCurrentWSTime">
					<property name="bodyName" value="currentWSTime" />
					<property name="millisBodyName" value="currentWSMillisTime" />
				</action>
				<action class="biz.ideasoft.soa.esb.actions.soap.WSInvoker" name="wsInvoker-action">
					<property name="urlPropertyLocation" value="routePhysicalURL" />
					<property name="SOAPActionPropertyLocation" value="soapAction" />
					<property name="keyStoreFilePathProperty" value="keyStoreFilePath" />
					<property name="keyStorePwdProperty" value="keyStorePwd" />
					<property name="trustStoreFilePathProperty" value="trustStoreFilePath" />
					<property name="trustStorePwdProperty" value="trustStorePwd" />
					<property name="maxConnectionsPerHost" value="10" />
					<property name="currentCostAction" value="currentPGEWSInvokerMillisTime" />
					<property name="timeoutMillis" value="59000" />
				</action>
				<action class="uy.gub.agesic.esb.action.SetElapsedTimeAction"
					name="setCurrentWSElapsedTime">
					<property name="bodyName" value="currentWSElapsedTime" />
					<property name="millisBodyName" value="currentWSMillisTime" />
				</action>
				
				<action class="biz.ideasoft.soa.esb.actions.SaveMTOMBodyAction" name="save-response-mtom" />
				
				<action class="biz.ideasoft.soa.esb.actions.SetWsaPropertiesAction" name="set-wsa-reponse-properties" >
					<property name="action-header-required" value="false" />
					<property name="to-header-required" value="false" />
					<property name="messageID-header-required" value="false" />
				</action>
				
				<action class="uy.gub.agesic.esb.action.ConnectorLoggerAction" name="log-message-after-invoke">
					<property name="origin" value="CON"/>
					<property name="loggerJMS" value="false"/>
					<property name="serviceCategory" value="AgesicPlataforma"/>
					<property name="serviceName" value="ConnectorLogger"/>
					<property name="serviceCategoryJMS" value="AgesicPlataforma"/>
					<property name="serviceNameJMS" value="ConnectorLoggerJMS"/>
					<property name="traceLevel" value="info" />
				</action>
				
				<action class="biz.ideasoft.soa.esb.actions.RestoreMTOMBodyAction" name="restore-response-mtom" />
			</actions>
		</service>
		<service category="AgesicPlataforma" description="Servicio de Trazas" invmScope="GLOBAL" name="ConnectorLogger">
			<property name="maxThreads" value="20" />
			<actions mep="OneWay">
				<action name="logMessage" class="uy.gub.agesic.esb.action.logger.ConnectorMessageLogger"/>
			</actions>
		</service>
		<service category="AgesicPlataforma" description="Servicio de Trazas JMS" invmScope="NONE" name="ConnectorLoggerJMS">
			<listeners>				
				<jms-listener name="connector-logger" busidref="loggerEsbChannel" maxThreads="5"/>
			</listeners>
			<actions mep="OneWay">
				<action name="logMessage" class="uy.gub.agesic.esb.action.logger.ConnectorMessageLogger"/>
			</actions>
		</service>
	</services>
</jbossesb>
